# ๐๏ธ ะััะธัะตะบัััะฐ ะฟัะพะตะบัะฐ

## ะะฑัะฐั ััััะบัััะฐ

```
assistant/
โโโ main/                  # Electron main ะฟัะพัะตัั
โ   โโโ electron.ts        # ะขะพัะบะฐ ะฒัะพะดะฐ, ัะพะทะดะฐะฝะธะต ะพะบะฝะฐ
โ   โโโ ipc.ts             # IPC ะพะฑัะฐะฑะพััะธะบะธ
โ   โโโ preload.ts         # Preload ัะบัะธะฟั (ะผะพัั ะผะตะถะดั main ะธ renderer)
โ   โโโ utils/             # ะฃัะธะปะธัั main ะฟัะพัะตััะฐ
โ
โโโ backend-electron/      # Backend ะปะพะณะธะบะฐ ะฒ Electron ะฟัะพัะตััะต
โ   โโโ server.ts          # HTTP ัะตัะฒะตั ะดะปั UI
โ   โโโ voice.ts           # ะะพะปะพัะพะฒะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต
โ   โโโ stt.ts             # Speech-to-Text
โ   โโโ tts.ts             # Text-to-Speech
โ   โโโ llm.ts             # LLM ะธะฝัะตะณัะฐัะธั
โ   โโโ config.ts          # ะะพะฝัะธะณััะฐัะธั
โ
โโโ ui-electron/           # React UI ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ src/
โ   โ   โโโ screens/       # ะญะบัะฐะฝั ะฟัะธะปะพะถะตะฝะธั
โ   โ   โ   โโโ MainScreen/
โ   โ   โ   โโโ ChatScreen/
โ   โ   โ   โโโ MenuScreen/
โ   โ   โ   โโโ WelcomeScreen/
โ   โ   โ
โ   โ   โโโ components/    # ะะตัะตะธัะฟะพะปัะทัะตะผัะต ะบะพะผะฟะพะฝะตะฝัั
โ   โ   โ   โโโ ChatKeyboard/  # ะะธัััะฐะปัะฝะฐั ะบะปะฐะฒะธะฐัััะฐ
โ   โ   โ   โโโ ...
โ   โ   โ
โ   โ   โโโ store/         # Redux store
โ   โ   โ   โโโ slices/    # Redux slices
โ   โ   โ   โโโ thunks/    # Async actions
โ   โ   โ   โโโ index.ts
โ   โ   โ
โ   โ   โโโ hooks/         # React ััะบะธ
โ   โ   โโโ utils/         # ะฃัะธะปะธัั
โ   โ   โโโ i18n/          # ะะฝัะตัะฝะฐัะธะพะฝะฐะปะธะทะฐัะธั
โ   โ   โโโ App.tsx        # ะะพัะฝะตะฒะพะน ะบะพะผะฟะพะฝะตะฝั
โ   โ
โ   โโโ index.html
โ
โโโ backend-main/          # Backend ัะตัะฒะตั (Node.js + MongoDB)
โ   โโโ src/
โ       โโโ controllers/   # ะะพะฝััะพะปะปะตัั API
โ       โโโ models/        # Mongoose ะผะพะดะตะปะธ
โ       โโโ routes/        # Express ัะพััั
โ       โโโ services/      # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ       โโโ middleware/     # Express middleware
โ
โโโ docs/                  # ะะพะบัะผะตะฝัะฐัะธั
โโโ scripts/               # ะัะฟะพะผะพะณะฐัะตะปัะฝัะต ัะบัะธะฟัั
โโโ dist/                  # ะกะพะฑัะฐะฝะฝัะต ัะฐะนะปั
```

## ะัะฝะพะฒะฝัะต ะบะพะผะฟะพะฝะตะฝัั

### 1. Electron Main Process (`main/`)

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- ะกะพะทะดะฐะฝะธะต ะธ ัะฟัะฐะฒะปะตะฝะธะต ะพะบะฝะฐะผะธ
- IPC ะบะพะผะผัะฝะธะบะฐัะธั ะผะตะถะดั ะฟัะพัะตััะฐะผะธ
- ะะพัััะฟ ะบ ัะธััะตะผะฝัะผ API

**ะะปััะตะฒัะต ัะฐะนะปั:**

- `electron.ts` - ะขะพัะบะฐ ะฒัะพะดะฐ, ัะพะทะดะฐะฝะธะต BrowserWindow
- `preload.ts` - Preload ัะบัะธะฟั, ัะบัะฟะพััะธััะตั ะฑะตะทะพะฟะฐัะฝัะต API ะฒ renderer
- `ipc.ts` - ะะฑัะฐะฑะพััะธะบะธ IPC ัะพะพะฑัะตะฝะธะน

### 2. UI Application (`ui-electron/`)

**ะขะตัะฝะพะปะพะณะธะธ:**

- React 18 + TypeScript
- Redux Toolkit ะดะปั state management
- Material-UI ะดะปั ะบะพะผะฟะพะฝะตะฝัะพะฒ
- THREE.js ะดะปั 3D ะณัะฐัะธะบะธ
- React Router ะดะปั ะฝะฐะฒะธะณะฐัะธะธ

**ะกัััะบัััะฐ Redux Store:**

```typescript
{
  ui: { screen, subScreen, isTransitioning, ... },
  voice: { isRecording, isProcessing, ... },
  chat: { dialogs, messages, currentDialogId, ... },
  settings: { theme, accentColor, ... },
  user: { isAuthenticated, userData, ... },
  apiKeys: { keys, ... }
}
```

**ะะพััะธะฝะณ:**

- `/` ะธะปะธ `/main` โ MainScreen (3D ะฟะตััะพะฝะฐะถ)
- `/chat` โ ChatScreen (ัะตะบััะพะฒัะน ัะฐั)
- `/menu` โ MenuScreen
- `/menu/settings` โ SettingsScreen
- `/menu/apiKeys` โ APIKeysScreen
- `/menu/logs` โ LogsScreen
- `/menu/about` โ AboutScreen
- `/menu/auth` โ AuthScreen

### 3. Backend Electron (`backend-electron/`)

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- HTTP ัะตัะฒะตั ะดะปั UI (ะฟะพัั 3000)
- ะะพะปะพัะพะฒะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต (STT โ LLM โ TTS)
- ะะฝัะตะณัะฐัะธั ั LLM ะฟัะพะฒะฐะนะดะตัะฐะผะธ

**ะะพัะพะบ ะณะพะปะพัะพะฒะพะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธั:**

1. `voice.ts` - ะะฐะฟะธัั ะฐัะดะธะพ
2. `stt.ts` - ะัะตะพะฑัะฐะทะพะฒะฐะฝะธะต ัะตัะธ ะฒ ัะตะบัั
3. `llm.ts` - ะะตะฝะตัะฐัะธั ะพัะฒะตัะฐ ัะตัะตะท LLM
4. `tts.ts` - ะัะตะพะฑัะฐะทะพะฒะฐะฝะธะต ัะตะบััะฐ ะฒ ัะตัั
5. ะะพัะฟัะพะธะทะฒะตะดะตะฝะธะต ะฐัะดะธะพ

### 4. Backend Main (`backend-main/`)

**ะัะฒะตัััะฒะตะฝะฝะพััั:**

- REST API ัะตัะฒะตั (ะฟะพัั 3001)
- ะะฐะฑะพัะฐ ั MongoDB
- OAuth ะฐะฒัะพัะธะทะฐัะธั
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะธ ะดะธะฐะปะพะณะฐะผะธ

**API Endpoints:**

- `/api/v1/auth/*` - OAuth ะฐะฒัะพัะธะทะฐัะธั
- `/api/v1/users/*` - ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
- `/api/v1/dialogs/*` - ะฃะฟัะฐะฒะปะตะฝะธะต ะดะธะฐะปะพะณะฐะผะธ
- `/api/v1/messages/*` - ะฃะฟัะฐะฒะปะตะฝะธะต ัะพะพะฑัะตะฝะธัะผะธ

## ะะพัะพะบะธ ะดะฐะฝะฝัั

### ะะพะปะพัะพะฒะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต:

```
Microphone โ backend-electron/voice.ts โ STT โ LLM โ TTS โ Speaker
```

### ะขะตะบััะพะฒัะน ัะฐั:

```
UI (ChatScreen) โ Redux (chatSlice) โ API (backend-main) โ MongoDB
```

### IPC ะบะพะผะผัะฝะธะบะฐัะธั:

```
Renderer Process โโ Preload Script โโ Main Process
```

## ะะฐะถะฝัะต ะฟะฐััะตัะฝั

### 1. Redux State Management

- ะัะต ัะพััะพัะฝะธะต ะฒ Redux Toolkit
- Async ะปะพะณะธะบะฐ ะฒ thunks
- ะกะตัะธะฐะปะธะทัะตะผัะต ะดะฐะฝะฝัะต (Date โ ISO string)

### 2. ะะพััะธะฝะณ

- URL-ัะพััะธะฝะณ ัะตัะตะท React Router
- ะกะธะฝััะพะฝะธะทะฐัะธั ั Redux ัะตัะตะท `RouterSync`
- ะัะตะดะพัะฒัะฐัะตะฝะธะต race conditions ัะตัะตะท `useRef`

### 3. ะขะตััะธัะพะฒะฐะฝะธะต

- Playwright ะดะปั ะฒะธะทัะฐะปัะฝัั ัะตััะพะฒ
- ะกะฝะฐะฟัะพัั ััะดะพะผ ั ัะตััะฐะผะธ (`*.spec.ts-snapshots/`)
- ะัะพััะฟะปะฐััะพัะผะตะฝะฝัะต ัะฝะฐะฟัะพัั (ะฑะตะท ััััะธะบัะฐ ะฟะปะฐััะพัะผั)

### 4. ะกะฑะพัะบะฐ

- Vite ะดะปั UI (dev server + production build)
- TypeScript ะดะปั main ะฟัะพัะตััะฐ
- Electron Builder ะดะปั ะดะธัััะธะฑััะธะธ

## ะะฐะฒะธัะธะผะพััะธ ะผะตะถะดั ะผะพะดัะปัะผะธ

```
main/electron.ts
  โโโ backend-electron/server.ts (HTTP ัะตัะฒะตั)
  โโโ ui-electron/ (ะทะฐะณััะถะฐะตััั ะฒ BrowserWindow)

ui-electron/
  โโโ Redux Store (ะปะพะบะฐะปัะฝะพะต ัะพััะพัะฝะธะต)
  โโโ API calls โ backend-main (REST API)

backend-electron/
  โโโ LLM providers (OpenAI, Yandex GPT)

backend-main/
  โโโ MongoDB (ััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั)
```
